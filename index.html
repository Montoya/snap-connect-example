<!DOCTYPE html>
<html>

<head>

  <title>Snap connect test</title>

</head>

<body>

  <p>Detecting...</p>

  <script type="text/javascript">

/* 
 * environment detection
 * 
 * this works for local testing and production deployment
 * at the very least you can use GitHub pages to make a production 
 * deployment and allow users to install your snap from npm
 */
if ( ["localhost", "127.0.0.1", ""].includes(window.location.hostname) ) {
  const snapId = 'local:http://localhost:8080';
}
else { 
  const snapId = 'npm:mobymask-snap'; 
}

/* 
 * feature detection
 * 
 * rather than detecting for Flask, we detect for a Snaps-specific 
 * method to determine if the user is running an extension that supports
 * Snaps; this works for both Flask and MetaMask stable 
 */
const getProvider = async () => {
  if ('detected' in window.ethereum) {
    for (const provider of window.ethereum.detected) {
      try {
        // Detect snaps support
        await provider.request({
          method: 'wallet_getSnaps',
        });
        // Disables the popup
        window.ethereum.setProvider(provider);
        return provider;
      } catch {
        // no-op
      }
    }
  }

  return window.ethereum;
};

const provider = getProvider(); 

const result = await provider.request({
  method: 'wallet_getSnaps', 
}); 

console.log(result); 

  </script>

</body>

</html>